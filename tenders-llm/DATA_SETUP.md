# Data Setup Guide

## Expected Directory Structure

```
tenders-llm/
├── data/
│   ├── raw/
│   │   ├── tenders_content.xlsx    ← Primary data source (with full text)
│   │   ├── tenders.xlsx            ← Alternative data source (FULL SET sheet)
│   │   ├── Services.xlsx           ← BAK Economics services (37 items)
│   │   ├── selected_ids.csv        ← Manually labeled positive IDs
│   │   ├── keywords.csv            ← (Optional) Keywords for prompt
│   │   └── case_studies/           ← (Optional) 222 PDF files
│   │       ├── study_001.pdf
│   │       └── ...
│   │
│   └── processed/                   ← Generated by scripts (don't commit)
│       ├── tenders_clean.parquet
│       ├── train_ids.txt
│       ├── val_ids.txt
│       ├── test_ids.txt
│       └── preds_*.jsonl
│
├── scripts/
│   ├── 00_reload_data_with_fulltext.py  ← Use this one!
│   ├── 00_reload_data.py                ← Legacy
│   ├── 01_prepare_data.py
│   ├── 02_make_splits.py
│   ├── 03_build_prompt.py
│   ├── 04_llm_predict.py
│   └── 05_eval.py
│
└── ... (other files)
```

---

## 🚀 Quick Start

### 1. Place Your Data Files

```bash
cd tenders-llm

# Ensure these files exist:
ls data/raw/tenders_content.xlsx  # Must have "TITLES" sheet with "full text" column
ls data/raw/selected_ids.csv      # List of positive tender IDs
ls data/raw/Services.xlsx          # BAK Economics services
```

### 2. Run Data Pipeline

```bash
# Step 1: Load and clean raw data
python scripts/00_reload_data_with_fulltext.py

# Step 2: Prepare data (clean text, detect language, create labels)
python scripts/01_prepare_data.py

# Step 3: Create train/val/test splits
python scripts/02_make_splits.py

# You're ready to run experiments!
```

---

## 📁 Data File Formats

### Required: `tenders_content.xlsx`

**Sheet:** `TITLES`

**Columns:**
- `title` - Tender title (required)
- `deadline` - Submission deadline (required)
- `N2` - Binary label: 0 = not selected, 1 = selected (required)
- `full text` - Full tender description in XML/HTML format (required)

**Example:**
| title | deadline | N2 | full text |
|-------|----------|----|----|
| "Studie Wirtschaftsförderung..." | 2025-10-30 | 1 | `<?xml version...` |

### Required: `selected_ids.csv`

**Format:** One tender ID per line

```
1016039
1017173
1032287
...
```

### Required: `Services.xlsx`

**Columns:**
- `service name` - Name of BAK Economics service
- `description` - Description of the service

**Example:**
| service name | description |
|--------------|-------------|
| Datenportal | Das Datenportal von BAK Economics... |

---

## ⚙️ All Scripts Now Use Relative Paths

**✅ Changed from:**
```python
# OLD (hardcoded absolute path)
SOURCE_EXCEL = "/Users/anastasiiadobson/Desktop/CAPSTONE PROJECT/..."
```

**✅ Changed to:**
```python
# NEW (relative path)
BASE_DIR = Path(__file__).parent.parent  # tenders-llm/
SOURCE_EXCEL = BASE_DIR / "data" / "raw" / "tenders_content.xlsx"
```

**Benefits:**
- ✅ Works on any machine
- ✅ Works on Windows/Mac/Linux
- ✅ No path configuration needed
- ✅ Git-friendly (no absolute paths)

---

## 🔄 Data Update Workflow

### When New SIMAP Data Arrives

```bash
# 1. Place new file in data/raw/
cp ~/Downloads/tenders_content_new.xlsx data/raw/tenders_content.xlsx

# 2. Re-run data pipeline
python scripts/00_reload_data_with_fulltext.py
python scripts/01_prepare_data.py
python scripts/02_make_splits.py

# 3. Re-run experiments
export EXPERIMENT_NAME="exp_new_data_oct2025"
python scripts/04_llm_predict.py
python scripts/05_eval_with_mlflow.py

# MLflow will automatically detect:
# - data.tenders_total changed: 4748 → 5000
# - data.data_hash changed: a3f5c2... → d7e9f1...
```

---

## 📝 Notes

### Primary Script
Use `00_reload_data_with_fulltext.py` - it:
- Loads from `tenders_content.xlsx` (TITLES sheet)
- Processes full text column
- Cleans HTML/XML tags
- Creates clean dataset

### Legacy Script  
`00_reload_data.py` is kept for reference but:
- Uses older data format (tenders.xlsx FULL SET sheet)
- Doesn't process full text properly
- Not recommended for new work

### Optional Files
- `keywords.csv` - Not required, but used if present
- `services.md` - Not required (converted from Services.xlsx)
- `case_studies/*.pdf` - Not required (experimental feature)

---

## ✅ Verify Setup

```bash
# Check all required files exist
python -c "
from pathlib import Path

files = [
    'data/raw/tenders_content.xlsx',
    'data/raw/selected_ids.csv',
    'data/raw/Services.xlsx'
]

for f in files:
    p = Path(f)
    if p.exists():
        print(f'✓ {f}')
    else:
        print(f'✗ {f} - MISSING!')
"
```

Expected output:
```
✓ data/raw/tenders_content.xlsx
✓ data/raw/selected_ids.csv
✓ data/raw/Services.xlsx
```

---

## 🐛 Troubleshooting

### Error: "No such file or directory: data/raw/tenders_content.xlsx"

**Solution:** Place the Excel file in the correct location:
```bash
# From tenders-llm directory:
ls data/raw/tenders_content.xlsx

# If not there, copy it:
cp /path/to/your/file.xlsx data/raw/tenders_content.xlsx
```

### Error: "Missing required column: full text"

**Solution:** Ensure the Excel file has the "TITLES" sheet with all required columns:
- title
- deadline  
- N2
- full text

### Scripts Run from Wrong Directory

**Always run scripts from the tenders-llm directory:**
```bash
cd tenders-llm  # Important!
python scripts/00_reload_data_with_fulltext.py  # ✓ Correct

# Not from scripts/ directory:
# cd scripts  # ✗ Wrong!
# python 00_reload_data_with_fulltext.py  # Will fail
```

The scripts use `Path(__file__).parent.parent` which assumes they're run from project root.

---

**Last Updated:** 2025-10-09  
**Status:** All scripts updated to use relative paths

